var link=document.createElement("link");link.href="./styles.css",link.type="text/css",link.rel="stylesheet",link.media="screen,print",document.getElementsByTagName("head")[0].appendChild(link);let data,filters;const $=jQuery,parseData=(a,t)=>{var e,i=a.shift();let r=t.split(",").map(a=>a.split(":"));return a.map(function(a,t){let e=i.reduce(function(t,e,i){return t[e.trim()]=a[i],t},{});return{id:t,...e}}).filter(a=>{let t=!0;return r.forEach(e=>{a[e[0]]!=e[1]&&(t=!1)}),t})},parseColors=a=>{try{let t=[];return a.values.forEach(a=>{t[a[0]]=a[1]}),t}catch(e){console.log(e)}},fetchColors=async a=>{let t=await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${a}/values/Colors?key=AIzaSyD476egRKXU8tY8HD2z55SuXYdjCplBENI`),e=await t.json();return parseColors(e)},fetchData=async(a,t,e)=>{let i=await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${a}/values/${t}?key=AIzaSyD476egRKXU8tY8HD2z55SuXYdjCplBENI`);return parseData((await i.json()).values,e)},parsedFilters=(a,t)=>{let e={};return a.forEach(a=>{let i=["Todos"];t?.forEach(t=>{i.includes(t[a])||""==t[a]||i.push(t[a])}),e[a.trim()]={value:"Todos",options:i}}),e},updateProfiles=()=>{let a=data.filter(a=>{let t=!0;return Object.keys(filters).forEach(e=>{"Todos"!=filters[e].value&&a[e]!=filters[e].value&&(t=!1)}),t});createProfiles(a,[])},createFilters=(a,t)=>{Object.keys(a).forEach(t=>{let e=$('<div class="dinatar-filter-item"></div>'),i=$(`<label class="dinatar-filter-label" for="${t}">${t}</label>`),r=$(`<select  class="select-dinatar" data-name="${t}" id="${t}"></select>`);a[t].options.forEach(a=>{let t=$(`<option value="${a}">${a}</option>`);r.append(t)}),r.on("change",function(){filters[t].value=$(this).val(),updateProfiles()}),e.append(i),e.append(r),$(".dinatar-filters").append(e)})},updateModal=a=>{let t=a["Cargo que busca"],e=a.Territorio,i=a.Coavales;$('[data-modal-name="dinatar-modal-profile"] .dinatar-modal__image').attr("src",a.Foto),$('[data-modal-name="dinatar-modal-profile"] .another-info').html(`
    <h3 class="dinatar-modal__title">${a.Nombres} ${a["Apellido 1"]} ${a["Apellido 2"]}</h3>
    ${t.length?`<span>${t}</span>`:""}
    ${e.length?`<span>${e}</span>`:""}
    ${i.length?`<span><strong>Coavales: </strong> ${i}</span>`:""}
  `),$('[data-modal-name="dinatar-modal-profile"] .dinatar-modal__content').html(`
    <p>${a.Perfil}</p>
  `)},createModal=()=>{let a=$("body");a.append(`
    <div
      class="dinatar-modal"
      data-modal-name="dinatar-modal-profile"
      data-modal-dismiss
    >
      <div class="dinatar-modal__dialog">
        <button class="dinatar-modal__close" data-modal-dismiss>\xd7</button>
        <header class="dinatar-modal__header">
          <img
            class="dinatar-modal__image"
            src=""
            alt=""
            srcset=""
          />
          <div class="another-info"></div>
        </header>
        <div class="dinatar-modal__content">
          <p class="profile-description"></p>
        </div>
        <footer class="dinatar-modal__footer">
          <button data-modal-dismiss class="dinatar-modal-close-btn">Cerrar</button>
        </footer>
      </div>
    </div>
  `)},createProfiles=(a,t)=>{console.log(t),$("#dinatar-container-profiles").html(""),a.forEach((a,e)=>{let i=`${a.Nombres} ${a["Apellido 1"]} ${a["Apellido 2"]}`,r=a["Cargo que busca"],l=a.Partido,s=t[a.Partido]||"rgb(159, 155, 145)",d=$(`<div class="dinatar-profile" data-modal-trigger="dinatar-modal-profile" data-modal-profile-id="${a.id}"></div>`),o=$('<div class="profile-content"></div>'),n=$(`<div class="dinatar-profile-footer" style="background-color:${s}"></div>`),p=$(`<img src="${a.Foto}" alt="${i}">`),c=$(`<h3 class="dinatar-profile-name">${i}</h3>`),f=$(`<span class="profile-footer__item__one">${r}</span>`),m=$(`<span class="profile-footer__item__two">${l}</span>`);o.append(p),o.append(c),d.append(o),(r||l)&&(n.append(f),n.append(m),d.append(n)),$("#dinatar-container-profiles").append(d)})};$(async function(){if(!$("#dinatar").length)throw Error("Dinatar container not found, please add #dinatar to your HTML: <div id='dinatar'></div>");let a=document.querySelector('script[data-identity="dinatar-script"]'),t=a.dataset.id,e=a.dataset.name,i=a.dataset.withcolors,r=a.dataset.filtersoptions,l=a.dataset.getonly;if(!t)throw Error("Dinatar script tag is missing the data-id attribute, please add it.");if(!e)throw Error("Dinatar script tag is missing the data-name attribute, please add it.");if(!i)throw Error("Dinatar script tag is missing the data-withcolors attribute, please add it.");r&&(r=JSON.parse(r));let s=$("#dinatar"),d=$('<div class="dinatar-filters"></div>'),o=$('<div id="dinatar-container-profiles"></div>');s.append(d),s.append(o),filters=parsedFilters(r,data=await fetchData(t,e,l));let n=await fetchColors(t);createFilters(filters,data),createProfiles(data,n),createModal();var p,c=document.querySelectorAll("[data-modal-trigger]"),f=document.querySelectorAll("[data-modal-dismiss]"),m="is-modal-active";function u(a,t){for(let e=0;e<a.length;e++)!function(e){a[e].addEventListener("click",function(a){t(this,a)})}(e)}u(c,function(a){!function a(t,e){(p=document.querySelector('[data-modal-name="'+t+'"]')).classList.add(m);let i=data.find(a=>a.id==e);updateModal(i)}(a.dataset.modalTrigger,a.dataset.modalProfileId)}),u(f,function(a){var t;(void 0===(t=event)||t.target.hasAttribute("data-modal-dismiss"))&&p.classList.remove(m)})});